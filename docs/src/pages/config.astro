---
import Base from '../layouts/Base.astro';
import Terminal from '../components/Terminal.astro';
import { Code } from 'astro:components';
---

<Base title="Config" description="Configure dex storage and sync options">
  <h1>Config</h1>

  <p>Dex can be configured via a <code>dex.toml</code> file in your project root or home directory.</p>

  <h2>Storage</h2>

  <p>Dex supports two storage modes:</p>

  <table>
    <thead>
      <tr>
        <th>Mode</th>
        <th>Location</th>
        <th>Best For</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>in-repo</strong> (default)</td>
        <td><code>.dex/</code> at git root</td>
        <td>Team projects, version-controlled tasks</td>
      </tr>
      <tr>
        <td><strong>centralized</strong></td>
        <td><code>~/.dex/projects/&lt;key&gt;/</code></td>
        <td>Personal tasks, cross-project views</td>
      </tr>
    </tbody>
  </table>

  <h3>In-Repo</h3>

  <p>Tasks stored as <code>.dex/tasks/&lt;id&gt;.json</code> in your git repository. No configuration needed.</p>

  <p><strong>When to commit .dex/:</strong></p>
  <ul>
    <li>Shared projects where task history matters</li>
    <li>Long-running work that spans team members</li>
  </ul>

  <p><strong>When to gitignore .dex/:</strong></p>
  <ul>
    <li>Personal tasks only</li>
    <li>High task churn</li>
  </ul>

  <h3>Centralized</h3>

  <p>Store tasks in a project-specific folder under <code>~/.dex/projects/</code>:</p>

  <Terminal title="dex.toml">
    <Code
      code={`[storage]
engine = "file"

[storage.file]
mode = "centralized"`}
      lang="toml"
      theme="vitesse-black"
    />
  </Terminal>

  <h3>Path Overrides</h3>

  <p>Override the storage path via environment variable or CLI flag:</p>

  <Terminal title="Terminal">
    <Code
      code={`# Environment variable
export DEX_STORAGE_PATH=/custom/path/.dex

# CLI flag
dex list --storage-path /custom/path/.dex`}
      lang="bash"
      theme="vitesse-black"
    />
  </Terminal>

  <h2>GitHub Sync</h2>

  <p>Automatically sync tasks to GitHub Issues:</p>

  <Terminal title="dex.toml">
    <Code
      code={`[sync.github]
enabled = true
owner = "your-username"
repo = "dex-tasks"
token_env = "GITHUB_TOKEN"
label_prefix = "dex"`}
      lang="toml"
      theme="vitesse-black"
    />
  </Terminal>

  <p>Behavior:</p>
  <ul>
    <li>Top-level tasks → GitHub Issues</li>
    <li>Subtasks → Embedded in parent issue body</li>
    <li>Completed tasks → Issue closed</li>
    <li>Sync is one-way (local → GitHub)</li>
  </ul>

  <p>Use <a href="/cli#github">dex sync</a> to push tasks, or <a href="/cli#github">dex import</a> to pull a GitHub Issue into dex.</p>

  <h2>Environment Variables</h2>

  <table>
    <thead>
      <tr>
        <th>Variable</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>DEX_STORAGE_PATH</code></td>
        <td>Override storage directory</td>
      </tr>
      <tr>
        <td><code>GITHUB_TOKEN</code></td>
        <td>GitHub API token for sync feature</td>
      </tr>
    </tbody>
  </table>
</Base>
